{
  "name": "BlackSynapse",
  "nodes": [
    {
      "parameters": {
        "model": "llama3.2:1b",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
      "typeVersion": 1,
      "position": [
        672,
        512
      ],
      "id": "d9a95d34-5acf-4cfa-8436-e5327ef6373c",
      "name": "Ollama Chat Model",
      "credentials": {
        "ollamaApi": {
          "id": "E0eX7omiBZe8dM8s",
          "name": "Ollama account"
        }
      }
    },
    {
      "parameters": {
        "content": "## ASR \nGet Audio -> Call ASR -> RAG Pipeline",
        "width": 230
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        400,
        0
      ],
      "typeVersion": 1,
      "id": "77261bb1-ed04-457a-bb1d-894f2f3999ce",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## RAG Pipeline\nLLM w/Memory and Vector Database"
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        672,
        112
      ],
      "typeVersion": 1,
      "id": "f48f4699-1926-41b7-a1fa-41c69c39b01d",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## TTS\nPOST Into TTS API -> Speaker"
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        960,
        112
      ],
      "typeVersion": 1,
      "id": "9e8a87d5-3a2c-4728-8994-8d7f65848821",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## Trigger Node\nDetects a new recording from our Porcupine API and POSTs the file into Whisper.cpp",
        "width": 214
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "typeVersion": 1,
      "id": "5f6b6ad2-9fe3-4d91-95c7-9bc5c7c35d81",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://host.docker.internal:8001/play",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "audio/wav"
            }
          ]
        },
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1248,
        304
      ],
      "id": "40a45109-28b4-4d5c-80ba-954681dd77a6",
      "name": "Speaker"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text }}",
        "options": {
          "systemMessage": "You are Jarvis, an intelligent, articulate voice assistant designed to assist with tasks, answer questions, and hold natural conversations.\n\nYou speak with clarity, confidence, and purpose—concise when needed, detailed when appropriate. You adapt to the user's tone, but maintain a respectful and calm demeanor. You can make proactive suggestions when helpful.\n\nYou are always informative, never condescending. Avoid filler words. Use correct grammar.\n\nRespond as if you're speaking aloud: natural, structured, and engaging—but not overly verbose.\n\nIf you're uncertain, explain your reasoning clearly and suggest possible next steps.\n\nConstraint/Must: Make sure your output is only has alphabets, no other characters (No newline \\n)"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        672,
        304
      ],
      "id": "95c54230-8314-4c2e-86f0-959d4ed70a68",
      "name": "LLM - Ollama 3",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        448,
        400
      ],
      "id": "cb221684-09c6-4046-9b8b-864bc486f4b8",
      "name": "When chat message received",
      "webhookId": "cb6a87a3-ce5e-4c22-97fc-f400ae98092f"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://host.docker.internal:8880/v1/audio/speech",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n        \"model\": \"kokoro\",\n        \"input\": \"{{ $json.output }}\",\n        \"voice\": \"af_heart\",\n        \"response_format\": \"wav\",\n        \"speed\": 1.2,\n        \"stream\": false\n      }",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1024,
        304
      ],
      "id": "584cb754-181f-48cf-aa86-722fecf3cd3f",
      "name": "KokoroTTS",
      "alwaysOutputData": true,
      "executeOnce": false
    },
    {
      "parameters": {
        "triggerOn": "folder",
        "path": "/data/asr",
        "events": [
          "add",
          "change"
        ],
        "options": {
          "followSymlinks": true,
          "usePolling": true
        }
      },
      "type": "n8n-nodes-base.localFileTrigger",
      "typeVersion": 1,
      "position": [
        0,
        208
      ],
      "id": "23eb9e9c-d7e5-48d4-8157-5675e691d4aa",
      "name": "Local File Trigger",
      "retryOnFail": false,
      "alwaysOutputData": false,
      "executeOnce": false
    },
    {
      "parameters": {
        "content": "## Speaker API\nTakes the TTS Output and Plays it in the native speaker"
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1248,
        112
      ],
      "typeVersion": 1,
      "id": "5bf38d27-124b-4bf5-901b-0d37e1ef9d9c",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://host.docker.internal:8002/transcribe",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "audio/wav"
            }
          ]
        },
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        448,
        208
      ],
      "id": "f95a9bca-6faa-4349-a4a3-179b4d7aad09",
      "name": "ASR: Whisper.cpp",
      "executeOnce": false
    },
    {
      "parameters": {
        "fileSelector": "={{ $json.path }}",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        224,
        208
      ],
      "id": "716ddbb6-1b24-4296-b033-9d387cefce53",
      "name": "Read/Write Files from Disk"
    }
  ],
  "pinData": {},
  "connections": {
    "Ollama Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "LLM - Ollama 3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "LLM - Ollama 3": {
      "main": [
        [
          {
            "node": "KokoroTTS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "LLM - Ollama 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "KokoroTTS": {
      "main": [
        [
          {
            "node": "Speaker",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Local File Trigger": {
      "main": [
        [
          {
            "node": "Read/Write Files from Disk",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ASR: Whisper.cpp": {
      "main": [
        [
          {
            "node": "LLM - Ollama 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read/Write Files from Disk": {
      "main": [
        [
          {
            "node": "ASR: Whisper.cpp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "58455760-c3b4-4925-99cd-213c4799b94f",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "cf62c18d1d7d43f57771f2639fa7581d7f4995b1fc54b37462680c04da0cf259"
  },
  "id": "P6NWo0q9Ovxl2Qqf",
  "tags": []
}